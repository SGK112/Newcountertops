<!-- Breadcrumb -->
<div class="breadcrumb-section">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Contractors</li>
            </ol>
        </nav>
    </div>
</div>

<!-- Hero Section -->
<section class="page-hero">
    <div class="container">
        <div class="hero-content">
            <div class="hero-main">
                <h1 class="hero-title">Find Certified Countertop Professionals</h1>
                <p class="hero-subtitle">Connect with top-rated, licensed fabricators and installers in your area. Get multiple quotes and compare professionals.</p>
                
                <div class="hero-features">
                    <div class="feature-item">
                        <span class="feature-icon">✓</span>
                        <span>Licensed & insured</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">✓</span>
                        <span>Background checked</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">✓</span>
                        <span>Quality guaranteed</span>
                    </div>
                </div>
                
                <div class="hero-cta">
                    <button class="btn btn-primary btn-xl" onclick="openLeadForm()">Get Free Quotes</button>
                    <span class="cta-subtitle">Compare up to 3 professionals</span>
                </div>
            </div>
            
            <div class="hero-image">
                <img src="/images/contractors-hero.svg" alt="Professional countertop installation" 
                     onerror="this.style.display='none'">
            </div>
        </div>
        
        <!-- Trust bar -->
        <div class="trust-bar">
            <div class="trust-item">
                <span class="trust-number">2,500+</span>
                <span class="trust-label">Certified professionals</span>
            </div>
            <div class="trust-item">
                <span class="trust-number">50K+</span>
                <span class="trust-label">Projects completed</span>
            </div>
            <div class="trust-item">
                <span class="trust-number">4.8★</span>
                <span class="trust-label">Average rating</span>
            </div>
            <div class="trust-item">
                <span class="trust-number">24hrs</span>
                <span class="trust-label">Response time</span>
            </div>
        </div>
    </div>
</section>

<!-- Quick Lead Form -->
<section class="quick-form-section">
    <div class="container">
        <div class="quick-form-container">
            <h2>Tell us about your project</h2>
            <p>Answer a few quick questions to get matched with the perfect professionals</p>
            
            <form class="quick-form" id="quickLeadForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>What type of countertop project?</label>
                        <select name="projectType" class="form-select" required>
                            <option value="">Select project type</option>
                            <option value="kitchen-remodel">Kitchen Remodel</option>
                            <option value="bathroom-remodel">Bathroom Remodel</option>
                            <option value="new-construction">New Construction</option>
                            <option value="island-addition">Kitchen Island Addition</option>
                            <option value="repair-replacement">Repair/Replacement</option>
                            <option value="outdoor-kitchen">Outdoor Kitchen</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Preferred material</label>
                        <select name="material" class="form-select">
                            <option value="">Not sure yet</option>
                            <option value="granite">Granite</option>
                            <option value="quartz">Quartz</option>
                            <option value="marble">Marble</option>
                            <option value="quartzite">Quartzite</option>
                            <option value="concrete">Concrete</option>
                            <option value="butcher-block">Butcher Block</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Approximate square footage</label>
                        <select name="squareFootage" class="form-select">
                            <option value="">Select size</option>
                            <option value="0-25">Under 25 sq ft</option>
                            <option value="25-50">25-50 sq ft</option>
                            <option value="50-75">50-75 sq ft</option>
                            <option value="75-100">75-100 sq ft</option>
                            <option value="100+">Over 100 sq ft</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Timeline</label>
                        <select name="timeline" class="form-select">
                            <option value="">Select timeline</option>
                            <option value="asap">ASAP</option>
                            <option value="1-2-weeks">1-2 weeks</option>
                            <option value="1-month">Within 1 month</option>
                            <option value="2-3-months">2-3 months</option>
                            <option value="planning">Just planning</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ZIP Code</label>
                        <input type="text" name="zipCode" class="form-control" placeholder="Enter ZIP code" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="tel" name="phone" class="form-control" placeholder="(555) 123-4567" required>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary btn-xl">Get Matched with Pros</button>
                <p class="form-disclaimer">Free service. No obligation. Get up to 3 quotes.</p>
            </form>
        </div>
    </div>
</section>

<!-- Filter Section -->
<section class="filter-section">
    <div class="container">
        <h2>Browse Certified Professionals</h2>
        <div class="filter-bar">
            <div class="filter-group">
                <label>Location</label>
                <input type="text" id="locationFilter" class="form-control" placeholder="City, State or ZIP">
            </div>
            
            <div class="filter-group">
                <label>Specialties</label>
                <select id="specialtyFilter" class="form-select">
                    <option value="">All Specialties</option>
                    <option value="granite">Granite Specialists</option>
                    <option value="quartz">Quartz Experts</option>
                    <option value="marble">Marble Artisans</option>
                    <option value="custom-fabrication">Custom Fabrication</option>
                    <option value="restoration">Restoration Services</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>Rating</label>
                <select id="ratingFilter" class="form-select">
                    <option value="">Any Rating</option>
                    <option value="4.5">4.5+ Stars</option>
                    <option value="4.0">4.0+ Stars</option>
                    <option value="3.5">3.5+ Stars</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>Sort By</label>
                <select id="sortFilter" class="form-select">
                    <option value="rating">Highest Rated</option>
                    <option value="reviews">Most Reviews</option>
                    <option value="distance">Nearest</option>
                    <option value="experience">Most Experience</option>
                </select>
            </div>
            
            <button class="btn btn-outline filter-reset" onclick="resetContractorFilters()">Clear All</button>
        </div>
    </div>
</section>

<!-- Contractors Directory -->
<section class="contractors-section">
    <div class="container">
        <div class="results-header">
            <div class="results-count">
                <span id="resultsCount">Loading...</span> professionals found
            </div>
            <div class="view-toggle">
                <button class="view-btn active" data-view="grid">
                    Grid View
                </button>
                <button class="view-btn" data-view="list">
                    List View
                </button>
            </div>
        </div>
        
        <!-- Loading State -->
        <div class="loading-state" id="loadingState">
            <div class="skeleton-cards">
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
            </div>
        </div>
        
        <!-- Contractors Grid -->
        <div class="contractors-grid" id="contractorsGrid">
            <!-- Contractors will be loaded here via JavaScript -->
        </div>
        
        <!-- Empty State -->
        <div class="empty-state d-none" id="emptyState">
            <div class="empty-icon">🔍</div>
            <h3>No professionals found</h3>
            <p>Try adjusting your filters or <a href="#" onclick="resetContractorFilters()">clear all filters</a> to see more results.</p>
        </div>
        
        <!-- Load More -->
        <div class="load-more-section" id="loadMoreSection">
            <button class="btn btn-outline btn-lg" id="loadMoreBtn">Load More Professionals</button>
        </div>
    </div>
</section>

<!-- How It Works -->
<section class="how-it-works-section">
    <div class="container">
        <h2 class="section-title">How it works</h2>
        <div class="steps-grid">
            <div class="step-item">
                <div class="step-number">1</div>
                <h3>Tell us your needs</h3>
                <p>Describe your countertop project and preferences in just a few minutes.</p>
            </div>
            <div class="step-item">
                <div class="step-number">2</div>
                <h3>Get matched</h3>
                <p>We'll connect you with up to 3 qualified professionals in your area.</p>
            </div>
            <div class="step-item">
                <div class="step-number">3</div>
                <h3>Compare & hire</h3>
                <p>Review quotes, read reviews, and choose the best professional for your project.</p>
            </div>
        </div>
    </div>
</section>

<!-- Lead Form Modal -->
<div class="modal fade" id="leadFormModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Get Free Quotes from Local Professionals</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="lead-form-container">
                    <div class="progress-bar">
                        <div class="progress-step active" data-step="1">
                            <span class="step-number">1</span>
                            <span class="step-label">Project Details</span>
                        </div>
                        <div class="progress-step" data-step="2">
                            <span class="step-number">2</span>
                            <span class="step-label">Preferences</span>
                        </div>
                        <div class="progress-step" data-step="3">
                            <span class="step-number">3</span>
                            <span class="step-label">Contact Info</span>
                        </div>
                    </div>
                    
                    <form class="multi-step-form" id="detailedLeadForm">
                        <!-- Step 1: Project Details -->
                        <div class="form-step active" data-step="1">
                            <h3>Tell us about your project</h3>
                            <div class="form-group">
                                <label>What type of project is this?</label>
                                <div class="option-grid">
                                    <label class="option-card">
                                        <input type="radio" name="projectType" value="kitchen-remodel">
                                        <div class="option-content">
                                            <div class="option-icon">🏠</div>
                                            <span>Kitchen Remodel</span>
                                        </div>
                                    </label>
                                    <label class="option-card">
                                        <input type="radio" name="projectType" value="bathroom-remodel">
                                        <div class="option-content">
                                            <div class="option-icon">🛁</div>
                                            <span>Bathroom Remodel</span>
                                        </div>
                                    </label>
                                    <label class="option-card">
                                        <input type="radio" name="projectType" value="new-construction">
                                        <div class="option-content">
                                            <div class="option-icon">🏗️</div>
                                            <span>New Construction</span>
                                        </div>
                                    </label>
                                    <label class="option-card">
                                        <input type="radio" name="projectType" value="island-addition">
                                        <div class="option-content">
                                            <div class="option-icon">🏝️</div>
                                            <span>Kitchen Island</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Approximate square footage needed?</label>
                                <select name="squareFootage" class="form-select" required>
                                    <option value="">Select size</option>
                                    <option value="0-25">Under 25 sq ft</option>
                                    <option value="25-50">25-50 sq ft</option>
                                    <option value="50-75">50-75 sq ft</option>
                                    <option value="75-100">75-100 sq ft</option>
                                    <option value="100+">Over 100 sq ft</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Step 2: Preferences -->
                        <div class="form-step" data-step="2">
                            <h3>What are your preferences?</h3>
                            <div class="form-group">
                                <label>Preferred countertop material?</label>
                                <div class="option-grid">
                                    <label class="option-card">
                                        <input type="radio" name="material" value="granite">
                                        <div class="option-content">
                                            <div class="option-icon">⚫</div>
                                            <span>Granite</span>
                                        </div>
                                    </label>
                                    <label class="option-card">
                                        <input type="radio" name="material" value="quartz">
                                        <div class="option-content">
                                            <div class="option-icon">💎</div>
                                            <span>Quartz</span>
                                        </div>
                                    </label>
                                    <label class="option-card">
                                        <input type="radio" name="material" value="marble">
                                        <div class="option-content">
                                            <div class="option-icon">🤍</div>
                                            <span>Marble</span>
                                        </div>
                                    </label>
                                    <label class="option-card">
                                        <input type="radio" name="material" value="not-sure">
                                        <div class="option-content">
                                            <div class="option-icon">❓</div>
                                            <span>Not Sure</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>When do you want to start?</label>
                                <select name="timeline" class="form-select" required>
                                    <option value="">Select timeline</option>
                                    <option value="asap">As soon as possible</option>
                                    <option value="1-2-weeks">Within 1-2 weeks</option>
                                    <option value="1-month">Within 1 month</option>
                                    <option value="2-3-months">2-3 months</option>
                                    <option value="planning">Just planning ahead</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Estimated budget range?</label>
                                <select name="budget" class="form-select">
                                    <option value="">Prefer not to say</option>
                                    <option value="under-5k">Under $5,000</option>
                                    <option value="5k-10k">$5,000 - $10,000</option>
                                    <option value="10k-20k">$10,000 - $20,000</option>
                                    <option value="20k-plus">$20,000+</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Step 3: Contact Info -->
                        <div class="form-step" data-step="3">
                            <h3>How can professionals reach you?</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>First Name *</label>
                                    <input type="text" name="firstName" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label>Last Name *</label>
                                    <input type="text" name="lastName" class="form-control" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Email Address *</label>
                                <input type="email" name="email" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Phone Number *</label>
                                <input type="tel" name="phone" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label>ZIP Code *</label>
                                <input type="text" name="zipCode" class="form-control" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Additional Details (Optional)</label>
                                <textarea name="description" class="form-control" rows="3" 
                                    placeholder="Tell us more about your project, specific requirements, or questions..."></textarea>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="prevStepBtn" style="display: none;">Previous</button>
                <button type="button" class="btn btn-primary" id="nextStepBtn">Next</button>
                <button type="button" class="btn btn-primary" id="submitLeadBtn" style="display: none;">Get My Quotes</button>
            </div>
        </div>
    </div>
</div>

<style>
/* Contractors page specific styles */
.quick-form-section {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    padding: 60px 0;
}

.quick-form-container {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    padding: 40px;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    text-align: center;
}

.quick-form-container h2 {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 12px;
    color: #1e293b;
}

.quick-form-container p {
    color: #64748b;
    font-size: 18px;
    margin-bottom: 32px;
}

.quick-form {
    text-align: left;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    color: #374151;
}

.form-control, .form-select {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 16px;
    transition: border-color 0.3s ease;
}

.form-control:focus, .form-select:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.form-disclaimer {
    text-align: center;
    font-size: 14px;
    color: #6b7280;
    margin-top: 16px;
}

.contractors-section {
    padding: 80px 0;
}

.contractors-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 30px;
    margin-top: 40px;
}

.contractors-grid.list-view {
    grid-template-columns: 1fr;
}

.contractor-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    transition: all 0.3s ease;
}

.contractor-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
}

.contractor-header {
    background: linear-gradient(135deg, #3b82f6, #1e40af);
    color: white;
    padding: 24px;
    text-align: center;
}

.contractor-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    margin: 0 auto 16px;
}

.contractor-name {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 8px;
}

.contractor-business {
    opacity: 0.9;
    margin-bottom: 12px;
}

.contractor-rating {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 16px;
    font-weight: 600;
}

.contractor-content {
    padding: 24px;
}

.contractor-specialties {
    margin-bottom: 20px;
}

.specialty-tag {
    display: inline-block;
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    margin: 2px;
}

.contractor-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 20px;
    font-size: 14px;
}

.detail-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #64748b;
}

.contractor-actions {
    display: flex;
    gap: 12px;
}

.contractor-actions .btn {
    flex: 1;
}

/* Lead Form Modal Styles */
.modal-lg {
    max-width: 700px;
}

.progress-bar {
    display: flex;
    justify-content: space-between;
    margin-bottom: 40px;
    position: relative;
}

.progress-bar::before {
    content: '';
    position: absolute;
    top: 20px;
    left: 0;
    right: 0;
    height: 2px;
    background: #e5e7eb;
    z-index: 1;
}

.progress-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 2;
}

.progress-step.active .step-number {
    background: #3b82f6;
    color: white;
}

.progress-step.completed .step-number {
    background: #10b981;
    color: white;
}

.step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #e5e7eb;
    color: #6b7280;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    margin-bottom: 8px;
}

.step-label {
    font-size: 14px;
    color: #6b7280;
    text-align: center;
}

.form-step {
    display: none;
}

.form-step.active {
    display: block;
}

.option-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
    margin-top: 12px;
}

.option-card {
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.option-card:hover {
    border-color: #3b82f6;
    background: #f8faff;
}

.option-card input[type="radio"] {
    display: none;
}

.option-card input[type="radio"]:checked + .option-content {
    color: #3b82f6;
}

.option-card:has(input:checked) {
    border-color: #3b82f6;
    background: #f8faff;
}

.option-icon {
    font-size: 32px;
    margin-bottom: 8px;
}

.option-content span {
    font-weight: 600;
    font-size: 14px;
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .option-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .contractors-grid {
        grid-template-columns: 1fr;
    }
    
    .contractor-details {
        grid-template-columns: 1fr;
    }
    
    .contractor-actions {
        flex-direction: column;
    }
}
</style>

<script>
class ContractorsPage {
    constructor() {
        this.currentPage = 1;
        this.itemsPerPage = 12;
        this.loading = false;
        this.hasMore = true;
        this.filters = {};
        
        this.init();
        this.loadContractors();
    }
    
    init() {
        // Filter event listeners
        document.getElementById('locationFilter').addEventListener('input', 
            this.debounce((e) => {
                this.filters.location = e.target.value;
                this.resetAndLoad();
            }, 500)
        );
        
        document.getElementById('specialtyFilter').addEventListener('change', (e) => {
            this.filters.specialty = e.target.value;
            this.resetAndLoad();
        });
        
        document.getElementById('ratingFilter').addEventListener('change', (e) => {
            this.filters.rating = e.target.value;
            this.resetAndLoad();
        });
        
        document.getElementById('sortFilter').addEventListener('change', (e) => {
            this.filters.sortBy = e.target.value;
            this.resetAndLoad();
        });
        
        // Load more button
        document.getElementById('loadMoreBtn').addEventListener('click', () => {
            this.loadContractors(true);
        });
        
        // View toggle
        document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                this.toggleView(e.target.dataset.view);
            });
        });
        
        // Lead forms
        document.getElementById('quickLeadForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.submitQuickLead(e.target);
        });
        
        this.initLeadFormModal();
    }
    
    debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
    
    resetAndLoad() {
        this.currentPage = 1;
        this.hasMore = true;
        document.getElementById('contractorsGrid').innerHTML = '';
        this.loadContractors();
    }
    
    async loadContractors(append = false) {
        if (this.loading || !this.hasMore) return;
        
        this.loading = true;
        this.showLoading(!append);
        
        try {
            const params = new URLSearchParams({
                page: this.currentPage,
                limit: this.itemsPerPage,
                ...this.filters
            });
            
            const response = await fetch(`/api/fabricators?${params}`);
            const data = await response.json();
            
            if (data.fabricators && data.fabricators.length > 0) {
                this.renderContractors(data.fabricators, append);
                this.updateResultsCount(data.pagination.totalItems);
                this.hasMore = data.pagination.hasNextPage;
                this.currentPage++;
                
                if (!this.hasMore) {
                    document.getElementById('loadMoreSection').style.display = 'none';
                }
            } else if (!append) {
                this.renderPlaceholderContractors();
            }
        } catch (error) {
            console.error('Error loading contractors:', error);
            if (!append) {
                this.renderPlaceholderContractors();
            }
        }
        
        this.loading = false;
        this.hideLoading();
    }
    
    renderContractors(contractors, append = false) {
        const grid = document.getElementById('contractorsGrid');
        
        if (!append) {
            grid.innerHTML = '';
        }
        
        contractors.forEach(contractor => {
            const card = this.createContractorCard(contractor);
            grid.appendChild(card);
        });
        
        document.getElementById('emptyState').classList.add('d-none');
    }
    
    renderPlaceholderContractors() {
        const placeholderContractors = [
            {
                name: "Mike Johnson",
                business: "Elite Granite Solutions",
                rating: 4.9,
                reviews: 127,
                specialties: ["Granite", "Quartz", "Custom Fabrication"],
                experience: "15+ years",
                location: "Austin, TX",
                responseTime: "Same day",
                projectsCompleted: 500
            },
            {
                name: "Sarah Chen",
                business: "Precision Stone Works",
                rating: 4.8,
                reviews: 89,
                specialties: ["Marble", "Quartzite", "Restoration"],
                experience: "12+ years",
                location: "Denver, CO",
                responseTime: "2-4 hours",
                projectsCompleted: 300
            },
            {
                name: "David Rodriguez",
                business: "Modern Countertop Co.",
                rating: 4.7,
                reviews: 156,
                specialties: ["Quartz", "Concrete", "Contemporary Design"],
                experience: "10+ years",
                location: "Seattle, WA",
                responseTime: "4-6 hours",
                projectsCompleted: 250
            },
            {
                name: "Lisa Thompson",
                business: "Artisan Stone Craft",
                rating: 4.9,
                reviews: 203,
                specialties: ["Natural Stone", "Custom Edge Work", "Luxury Installs"],
                experience: "18+ years",
                location: "Phoenix, AZ",
                responseTime: "Same day",
                projectsCompleted: 750
            }
        ];
        
        const grid = document.getElementById('contractorsGrid');
        grid.innerHTML = '';
        
        placeholderContractors.forEach(contractor => {
            const card = this.createContractorCard(contractor);
            grid.appendChild(card);
        });
        
        this.updateResultsCount(placeholderContractors.length);
    }
    
    createContractorCard(contractor) {
        const card = document.createElement('div');
        card.className = 'contractor-card';
        
        const initials = contractor.name.split(' ').map(n => n[0]).join('');
        
        card.innerHTML = `
            <div class="contractor-header">
                <div class="contractor-avatar">${initials}</div>
                <h3 class="contractor-name">${contractor.name}</h3>
                <p class="contractor-business">${contractor.business}</p>
                <div class="contractor-rating">
                    <span>★ ${contractor.rating}</span>
                    <span>(${contractor.reviews} reviews)</span>
                </div>
            </div>
            <div class="contractor-content">
                <div class="contractor-specialties">
                    ${contractor.specialties.map(specialty => 
                        `<span class="specialty-tag">${specialty}</span>`
                    ).join('')}
                </div>
                <div class="contractor-details">
                    <div class="detail-item">
                        <span>📍</span>
                        <span>${contractor.location}</span>
                    </div>
                    <div class="detail-item">
                        <span>⏱️</span>
                        <span>${contractor.responseTime}</span>
                    </div>
                    <div class="detail-item">
                        <span>🏆</span>
                        <span>${contractor.experience}</span>
                    </div>
                    <div class="detail-item">
                        <span>✅</span>
                        <span>${contractor.projectsCompleted}+ projects</span>
                    </div>
                </div>
                <div class="contractor-actions">
                    <button class="btn btn-primary" onclick="requestQuoteFromContractor('${contractor._id || contractor.name}')">
                        Get Quote
                    </button>
                    <button class="btn btn-outline" onclick="viewContractorProfile('${contractor._id || contractor.name}')">
                        View Profile
                    </button>
                </div>
            </div>
        `;
        
        return card;
    }
    
    showLoading(full = false) {
        if (full) {
            document.getElementById('loadingState').classList.remove('d-none');
            document.getElementById('contractorsGrid').classList.add('d-none');
        }
        document.getElementById('loadMoreBtn').textContent = 'Loading...';
        document.getElementById('loadMoreBtn').disabled = true;
    }
    
    hideLoading() {
        document.getElementById('loadingState').classList.add('d-none');
        document.getElementById('contractorsGrid').classList.remove('d-none');
        document.getElementById('loadMoreBtn').textContent = 'Load More Professionals';
        document.getElementById('loadMoreBtn').disabled = false;
    }
    
    updateResultsCount(total) {
        document.getElementById('resultsCount').textContent = total;
    }
    
    toggleView(view) {
        const grid = document.getElementById('contractorsGrid');
        if (view === 'list') {
            grid.classList.add('list-view');
        } else {
            grid.classList.remove('list-view');
        }
    }
    
    async submitQuickLead(form) {
        const formData = new FormData(form);
        const leadData = Object.fromEntries(formData);
        
        try {
            const response = await fetch('/api/leads', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(leadData)
            });
            
            if (response.ok) {
                // Show success message
                form.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 64px; margin-bottom: 20px;">✅</div>
                        <h3>Thank You!</h3>
                        <p>We've received your request and will connect you with qualified professionals in your area within 24 hours.</p>
                        <button class="btn btn-primary" onclick="location.reload()">Submit Another Request</button>
                    </div>
                `;
            }
        } catch (error) {
            console.error('Error submitting lead:', error);
        }
    }
    
    initLeadFormModal() {
        let currentStep = 1;
        const totalSteps = 3;
        
        const nextBtn = document.getElementById('nextStepBtn');
        const prevBtn = document.getElementById('prevStepBtn');
        const submitBtn = document.getElementById('submitLeadBtn');
        
        nextBtn.addEventListener('click', () => {
            if (currentStep < totalSteps) {
                currentStep++;
                this.updateModalStep(currentStep);
            }
        });
        
        prevBtn.addEventListener('click', () => {
            if (currentStep > 1) {
                currentStep--;
                this.updateModalStep(currentStep);
            }
        });
        
        submitBtn.addEventListener('click', () => {
            this.submitDetailedLead();
        });
    }
    
    updateModalStep(step) {
        // Update progress bar
        document.querySelectorAll('.progress-step').forEach((el, index) => {
            if (index + 1 < step) {
                el.classList.add('completed');
                el.classList.remove('active');
            } else if (index + 1 === step) {
                el.classList.add('active');
                el.classList.remove('completed');
            } else {
                el.classList.remove('active', 'completed');
            }
        });
        
        // Update form steps
        document.querySelectorAll('.form-step').forEach((el, index) => {
            if (index + 1 === step) {
                el.classList.add('active');
            } else {
                el.classList.remove('active');
            }
        });
        
        // Update buttons
        document.getElementById('prevStepBtn').style.display = step > 1 ? 'block' : 'none';
        document.getElementById('nextStepBtn').style.display = step < 3 ? 'block' : 'none';
        document.getElementById('submitLeadBtn').style.display = step === 3 ? 'block' : 'none';
    }
    
    async submitDetailedLead() {
        const form = document.getElementById('detailedLeadForm');
        const formData = new FormData(form);
        const leadData = Object.fromEntries(formData);
        
        try {
            const response = await fetch('/api/leads', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(leadData)
            });
            
            if (response.ok) {
                // Close modal and show success
                const modal = bootstrap.Modal.getInstance(document.getElementById('leadFormModal'));
                modal.hide();
                
                // Show success notification
                alert('Thank you! We\'ll connect you with qualified professionals soon.');
            }
        } catch (error) {
            console.error('Error submitting detailed lead:', error);
        }
    }
}

// Global functions
function openLeadForm() {
    const modal = new bootstrap.Modal(document.getElementById('leadFormModal'));
    modal.show();
}

function requestQuoteFromContractor(contractorId) {
    // Open lead form with contractor pre-selected
    openLeadForm();
}

function viewContractorProfile(contractorId) {
    // Navigate to contractor profile page
    window.location.href = `/contractors/${contractorId}`;
}

function resetContractorFilters() {
    document.getElementById('locationFilter').value = '';
    document.getElementById('specialtyFilter').value = '';
    document.getElementById('ratingFilter').value = '';
    document.getElementById('sortFilter').value = 'rating';
    
    const page = new ContractorsPage();
    page.filters = {};
    page.resetAndLoad();
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
    new ContractorsPage();
});
</script>
