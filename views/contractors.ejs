<!-- Hero Section -->
<section class="page-hero">
    <div class="container">
        <div class="row justify-content-center text-center">
            <div class="col-12 col-lg-8">
                <h1>Find Local Contractors</h1>
                <p class="lead">Get matched with trusted and certified countertop professionals in your area.</p>
                <div class="hero-actions">
                    <a href="/get-quote" class="btn btn-primary btn-lg">Get Free Quotes</a>
                    <a href="/calculators" class="btn btn-outline btn-lg">Estimate Costs</a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Search Section -->
<section class="search-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-8">
                <div class="search-card">
                    <h2>Find Contractors Near You</h2>
                    <form class="contractor-search-form">
                        <div class="search-input-group">
                            <input type="text" class="form-control" placeholder="Enter your ZIP code" aria-label="ZIP code">
                            <button class="btn btn-primary" type="submit">Search</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- How It Works -->
<section class="how-it-works-section">
    <div class="container">
        <div class="row justify-content-center text-center">
            <div class="col-12 col-lg-8">
                <h2>How It Works</h2>
                <p class="lead">Get connected with qualified contractors in 3 easy steps</p>
            </div>
        </div>
        <div class="row">
            <div class="col-12 col-md-4">
                <div class="step-card">
                    <div class="step-number">1</div>
                    <h3>Tell Us Your Needs</h3>
                    <p>Share details about your countertop project including material preferences, size, and timeline.</p>
                </div>
            </div>
            <div class="col-12 col-md-4">
                <div class="step-card">
                    <div class="step-number">2</div>
                    <h3>Get Matched</h3>
                    <p>We connect you with up to 3 qualified contractors in your area who specialize in your project type.</p>
                </div>
            </div>
            <div class="col-12 col-md-4">
                <div class="step-card">
                    <div class="step-number">3</div>
                    <h3>Compare & Choose</h3>
                    <p>Review quotes, check references, and choose the contractor that best fits your needs and budget.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Benefits Section -->
<section class="benefits-section">
    <div class="container">
        <div class="row">
            <div class="col-12 col-lg-6">
                <h2>Why Choose Our Network?</h2>
                <div class="benefits-list">
                    <div class="benefit-item">
                        <div class="benefit-icon">‚úÖ</div>
                        <div class="benefit-content">
                            <h4>Verified Professionals</h4>
                            <p>All contractors are licensed, insured, and background-checked.</p>
                        </div>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">‚≠ê</div>
                        <div class="benefit-content">
                            <h4>Quality Guaranteed</h4>
                            <p>Our contractors maintain high ratings and offer warranties on their work.</p>
                        </div>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">üí∞</div>
                        <div class="benefit-content">
                            <h4>Competitive Pricing</h4>
                            <p>Compare multiple quotes to ensure you get the best value for your project.</p>
                        </div>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">üöÄ</div>
                        <div class="benefit-content">
                            <h4>Fast Response</h4>
                            <p>Get quotes within 24 hours from contractors ready to start your project.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-6">
                <div class="cta-card">
                    <h3>Ready to Start Your Project?</h3>
                    <p>Get free quotes from qualified contractors in your area today.</p>
                    <a href="/get-quote" class="btn btn-primary btn-lg">Get Free Quotes</a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- For Contractors -->
<section class="contractor-signup-section">
    <div class="container">
        <div class="row justify-content-center text-center">
            <div class="col-12 col-lg-8">
                <h2>Are You a Contractor?</h2>
                <p class="lead">Join our network of trusted professionals and grow your business with high-quality leads.</p>
                <div class="contractor-benefits">
                    <div class="row">
                        <div class="col-12 col-md-4">
                            <div class="contractor-benefit">
                                <div class="benefit-icon">üìà</div>
                                <h4>Grow Your Business</h4>
                                <p>Access pre-qualified leads in your area</p>
                            </div>
                        </div>
                        <div class="col-12 col-md-4">
                            <div class="contractor-benefit">
                                <div class="benefit-icon">üéØ</div>
                                <h4>Targeted Leads</h4>
                                <p>Get matched with projects that fit your expertise</p>
                            </div>
                        </div>
                        <div class="col-12 col-md-4">
                            <div class="contractor-benefit">
                                <div class="benefit-icon">üíº</div>
                                <h4>Professional Tools</h4>
                                <p>Access project management and customer tools</p>
                            </div>
                        </div>
                    </div>
                </div>
                <a href="/contractors/signup" class="btn btn-secondary btn-lg">Join Our Network</a>
            </div>
        </div>
    </div>
</section>

<style>
/* Contractors page styles - Mobile-first design */
.page-hero {
    background: linear-gradient(135deg, var(--accent-blue), var(--primary-color));
    color: var(--text-light);
    padding: 80px 0;
    text-align: center;
}

.page-hero h1 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
}

.page-hero .lead {
    font-size: 1.25rem;
    margin-bottom: 2rem;
}

.hero-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}

.hero-actions .btn {
    padding: 12px 24px;
    font-size: 1.1rem;
    border-radius: 8px;
    min-width: 200px;
}

.search-section {
    padding: 80px 0;
    background: var(--surface-color);
}

.search-card {
    background: var(--card-background);
    border-radius: 16px;
    padding: 40px;
    box-shadow: 0 10px 30px var(--shadow-medium);
    text-align: center;
}

.search-card h2 {
    color: var(--primary-color);
    margin-bottom: 1.5rem;
}

.search-input-group {
    display: flex;
    gap: 1rem;
    max-width: 400px;
    margin: 0 auto;
}

.search-input-group .form-control {
    flex: 1;
    padding: 12px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 1rem;
}

.search-input-group .btn {
    padding: 12px 24px;
    border-radius: 8px;
    white-space: nowrap;
}

.how-it-works-section {
    padding: 80px 0;
    text-align: center;
}

.how-it-works-section h2 {
    color: var(--primary-color);
    margin-bottom: 1rem;
    font-size: 2.5rem;
}

.step-card {
    padding: 2rem 1rem;
    text-align: center;
}

.step-number {
    width: 60px;
    height: 60px;
    background: var(--accent-blue);
    color: var(--text-light);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0 auto 1.5rem;
}

.step-card h3 {
    color: var(--primary-color);
    margin-bottom: 1rem;
}

.benefits-section {
    padding: 80px 0;
    background: var(--surface-color);
}

.benefits-section h2 {
    color: var(--primary-color);
    margin-bottom: 2rem;
    font-size: 2.5rem;
}

.benefits-list {
    margin-bottom: 2rem;
}

.benefit-item {
    display: flex;
    align-items: flex-start;
    margin-bottom: 2rem;
}

.benefit-icon {
    font-size: 1.5rem;
    margin-right: 1rem;
    flex-shrink: 0;
}

.benefit-content h4 {
    color: var(--primary-color);
    margin-bottom: 0.5rem;
}

.cta-card {
    background: var(--card-background);
    border-radius: 16px;
    padding: 40px;
    box-shadow: 0 10px 30px var(--shadow-medium);
    text-align: center;
    height: fit-content;
}

.cta-card h3 {
    color: var(--primary-color);
    margin-bottom: 1rem;
}

.cta-card p {
    margin-bottom: 2rem;
}

.contractor-signup-section {
    padding: 80px 0;
    text-align: center;
}

.contractor-signup-section h2 {
    color: #1e40af;
    margin-bottom: 1rem;
    font-size: 2.5rem;
}

.contractor-benefits {
    margin: 3rem 0;
}

.contractor-benefit {
    padding: 1.5rem;
    text-align: center;
}

.contractor-benefit .benefit-icon {
    font-size: 2rem;
    margin-bottom: 1rem;
}

.contractor-benefit h4 {
    color: #1e40af;
    margin-bottom: 0.5rem;
}

/* Button improvements with proper padding */
.btn {
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    display: inline-block;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.btn-lg {
    padding: 16px 32px;
    font-size: 1.1rem;
}

.btn-primary {
    background: var(--accent-blue);
    color: var(--text-light);
    border-color: var(--accent-blue);
}

.btn-primary:hover {
    background: var(--primary-hover);
    border-color: var(--primary-hover);
    transform: translateY(-2px);
}

.btn-secondary {
    background: var(--accent-yellow);
    color: var(--text-dark);
    border-color: var(--accent-yellow);
}

.btn-secondary:hover {
    background: var(--secondary-hover);
    border-color: var(--secondary-hover);
    transform: translateY(-2px);
}

.btn-outline {
    background: transparent;
    color: var(--accent-blue);
    border-color: var(--accent-blue);
}

.btn-outline:hover {
    background: var(--accent-blue);
    color: var(--text-light);
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
    .page-hero {
        padding: 60px 0;
    }
    
    .page-hero h1 {
        font-size: 2rem;
    }
    
    .hero-actions {
        flex-direction: column;
        align-items: center;
    }
    
    .hero-actions .btn {
        width: 100%;
        max-width: 300px;
    }
    
    .search-card {
        padding: 24px;
    }
    
    .search-input-group {
        flex-direction: column;
    }
    
    .search-input-group .btn {
        width: 100%;
    }
    
    .how-it-works-section h2,
    .benefits-section h2,
    .contractor-signup-section h2 {
        font-size: 2rem;
    }
    
    .benefits-section {
        padding: 60px 0;
    }
    
    .benefit-item {
        flex-direction: column;
        text-align: center;
    }
    
    .benefit-icon {
        margin-right: 0;
        margin-bottom: 1rem;
        font-size: 2rem;
    }
    
    .cta-card {
        padding: 24px;
        margin-top: 2rem;
    }
}

@media (max-width: 480px) {
    .page-hero h1 {
        font-size: 1.75rem;
    }
    
    .search-card,
    .cta-card {
        padding: 20px;
    }
    
    .step-number {
        width: 50px;
        height: 50px;
        font-size: 1.25rem;
    }
}
</style>
    border-radius: 8px;
    font-size: 16px;
}

.search-section .btn-primary {
    padding: 12px 24px;
    font-size: 16px;
    border-radius: 8px;
}

.featured-contractors {
    padding: 60px 0;
}

.featured-contractors h2 {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 40px;
}

.contractor-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    transition: all 0.3s ease;
}

.contractor-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px var(--shadow-large);
}

.contractor-header {
    background: linear-gradient(135deg, var(--accent-blue), var(--primary-color));
    color: var(--text-light);
    padding: 24px;
    text-align: center;
}

.contractor-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: var(--surface-overlay);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    margin: 0 auto 16px;
}

.contractor-name {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 8px;
}

.contractor-business {
    opacity: 0.9;
    margin-bottom: 12px;
}

.contractor-rating {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 16px;
    font-weight: 600;
}

.contractor-content {
    padding: 24px;
}

.contractor-specialties {
    margin-bottom: 20px;
}

.specialty-tag {
    display: inline-block;
    background: linear-gradient(135deg, var(--accent-yellow), var(--secondary-hover));
    color: var(--text-dark);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    margin: 2px;
}

.contractor-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 20px;
    font-size: 14px;
}

.detail-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text-secondary);
}

.contractor-actions {
    display: flex;
    gap: 12px;
}

.contractor-actions .btn {
    flex: 1;
}

/* CTA Section */
.cta-section {
    padding: 60px 0;
    background: var(--surface-color);
}

.cta-section h2 {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 16px;
}

.cta-section p {
    font-size: 18px;
    margin-bottom: 32px;
}

.cta-section .btn-secondary {
    padding: 12px 24px;
    font-size: 18px;
    border-radius: 24px;
}

/* Lead Form Modal Styles */
.modal-lg {
    max-width: 700px;
}

.progress-bar {
    display: flex;
    justify-content: space-between;
    margin-bottom: 40px;
    position: relative;
}

.progress-bar::before {
    content: '';
    position: absolute;
    top: 20px;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--border-light);
    z-index: 1;
}

.progress-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 2;
}

.progress-step.active .step-number {
    background: var(--accent-blue);
    color: var(--text-light);
}

.progress-step.completed .step-number {
    background: var(--success-color);
    color: var(--text-light);
}

.step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--border-light);
    color: var(--text-muted);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    margin-bottom: 8px;
}

.step-label {
    font-size: 14px;
    color: var(--text-muted);
    text-align: center;
}

.form-step {
    display: none;
}

.form-step.active {
    display: block;
}

.option-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
    margin-top: 12px;
}

.option-card {
    border: 2px solid var(--border-light);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.option-card:hover {
    border-color: var(--accent-blue);
    background: var(--hover-background);
}

.option-card input[type="radio"] {
    display: none;
}

.option-card input[type="radio"]:checked + .option-content {
    color: var(--accent-blue);
}

.option-card:has(input:checked) {
    border-color: var(--accent-blue);
    background: var(--hover-background);
}

.option-icon {
    font-size: 32px;
    margin-bottom: 8px;
}

.option-content span {
    font-weight: 600;
    font-size: 14px;
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .option-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .contractors-grid {
        grid-template-columns: 1fr;
    }
    
    .contractor-details {
        grid-template-columns: 1fr;
    }
    
    .contractor-actions {
        flex-direction: column;
    }
}
</style>

<script>
class ContractorsPage {
    constructor() {
        this.currentPage = 1;
        this.itemsPerPage = 12;
        this.loading = false;
        this.hasMore = true;
        this.filters = {};
        
        this.init();
        this.loadContractors();
    }
    
    init() {
        // Filter event listeners
        document.getElementById('locationFilter').addEventListener('input', 
            this.debounce((e) => {
                this.filters.location = e.target.value;
                this.resetAndLoad();
            }, 500)
        );
        
        document.getElementById('specialtyFilter').addEventListener('change', (e) => {
            this.filters.specialty = e.target.value;
            this.resetAndLoad();
        });
        
        document.getElementById('ratingFilter').addEventListener('change', (e) => {
            this.filters.rating = e.target.value;
            this.resetAndLoad();
        });
        
        document.getElementById('sortFilter').addEventListener('change', (e) => {
            this.filters.sortBy = e.target.value;
            this.resetAndLoad();
        });
        
        // Load more button
        document.getElementById('loadMoreBtn').addEventListener('click', () => {
            this.loadContractors(true);
        });
        
        // View toggle
        document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                this.toggleView(e.target.dataset.view);
            });
        });
        
        // Lead forms
        document.getElementById('quickLeadForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.submitQuickLead(e.target);
        });
        
        this.initLeadFormModal();
    }
    
    debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
    
    resetAndLoad() {
        this.currentPage = 1;
        this.hasMore = true;
        document.getElementById('contractorsGrid').innerHTML = '';
        this.loadContractors();
    }
    
    async loadContractors(append = false) {
        if (this.loading || !this.hasMore) return;
        
        this.loading = true;
        this.showLoading(!append);
        
        try {
            const params = new URLSearchParams({
                page: this.currentPage,
                limit: this.itemsPerPage,
                ...this.filters
            });
            
            const response = await fetch(`/api/fabricators?${params}`);
            const data = await response.json();
            
            if (data.fabricators && data.fabricators.length > 0) {
                this.renderContractors(data.fabricators, append);
                this.updateResultsCount(data.pagination.totalItems);
                this.hasMore = data.pagination.hasNextPage;
                this.currentPage++;
                
                if (!this.hasMore) {
                    document.getElementById('loadMoreSection').style.display = 'none';
                }
            } else if (!append) {
                this.renderPlaceholderContractors();
            }
        } catch (error) {
            console.error('Error loading contractors:', error);
            if (!append) {
                this.renderPlaceholderContractors();
            }
        }
        
        this.loading = false;
        this.hideLoading();
    }
    
    renderContractors(contractors, append = false) {
        const grid = document.getElementById('contractorsGrid');
        
        if (!append) {
            grid.innerHTML = '';
        }
        
        contractors.forEach(contractor => {
            const card = this.createContractorCard(contractor);
            grid.appendChild(card);
        });
        
        document.getElementById('emptyState').classList.add('d-none');
    }
    
    renderPlaceholderContractors() {
        const placeholderContractors = [
            {
                name: "Mike Johnson",
                business: "Elite Granite Solutions",
                rating: 4.9,
                reviews: 127,
                specialties: ["Granite", "Quartz", "Custom Fabrication"],
                experience: "15+ years",
                location: "Austin, TX",
                responseTime: "Same day",
                projectsCompleted: 500
            },
            {
                name: "Sarah Chen",
                business: "Precision Stone Works",
                rating: 4.8,
                reviews: 89,
                specialties: ["Marble", "Quartzite", "Restoration"],
                experience: "12+ years",
                location: "Denver, CO",
                responseTime: "2-4 hours",
                projectsCompleted: 300
            },
            {
                name: "David Rodriguez",
                business: "Modern Countertop Co.",
                rating: 4.7,
                reviews: 156,
                specialties: ["Quartz", "Concrete", "Contemporary Design"],
                experience: "10+ years",
                location: "Seattle, WA",
                responseTime: "4-6 hours",
                projectsCompleted: 250
            },
            {
                name: "Lisa Thompson",
                business: "Artisan Stone Craft",
                rating: 4.9,
                reviews: 203,
                specialties: ["Natural Stone", "Custom Edge Work", "Luxury Installs"],
                experience: "18+ years",
                location: "Phoenix, AZ",
                responseTime: "Same day",
                projectsCompleted: 750
            }
        ];
        
        const grid = document.getElementById('contractorsGrid');
        grid.innerHTML = '';
        
        placeholderContractors.forEach(contractor => {
            const card = this.createContractorCard(contractor);
            grid.appendChild(card);
        });
        
        this.updateResultsCount(placeholderContractors.length);
    }
    
    createContractorCard(contractor) {
        const card = document.createElement('div');
        card.className = 'contractor-card';
        
        const initials = contractor.name.split(' ').map(n => n[0]).join('');
        
        card.innerHTML = `
            <div class="contractor-header">
                <div class="contractor-avatar">${initials}</div>
                <h3 class="contractor-name">${contractor.name}</h3>
                <p class="contractor-business">${contractor.business}</p>
                <div class="contractor-rating">
                    <span>‚òÖ ${contractor.rating}</span>
                    <span>(${contractor.reviews} reviews)</span>
                </div>
            </div>
            <div class="contractor-content">
                <div class="contractor-specialties">
                    ${contractor.specialties.map(specialty => 
                        `<span class="specialty-tag">${specialty}</span>`
                    ).join('')}
                </div>
                <div class="contractor-details">
                    <div class="detail-item">
                        <span>üìç</span>
                        <span>${contractor.location}</span>
                    </div>
                    <div class="detail-item">
                        <span>‚è±Ô∏è</span>
                        <span>${contractor.responseTime}</span>
                    </div>
                    <div class="detail-item">
                        <span>üèÜ</span>
                        <span>${contractor.experience}</span>
                    </div>
                    <div class="detail-item">
                        <span>‚úÖ</span>
                        <span>${contractor.projectsCompleted}+ projects</span>
                    </div>
                </div>
                <div class="contractor-actions">
                    <button class="btn btn-primary" onclick="requestQuoteFromContractor('${contractor._id || contractor.name}')">
                        Get Quote
                    </button>
                    <button class="btn btn-outline" onclick="viewContractorProfile('${contractor._id || contractor.name}')">
                        View Profile
                    </button>
                </div>
            </div>
        `;
        
        return card;
    }
    
    showLoading(full = false) {
        if (full) {
            document.getElementById('loadingState').classList.remove('d-none');
            document.getElementById('contractorsGrid').classList.add('d-none');
        }
        document.getElementById('loadMoreBtn').textContent = 'Loading...';
        document.getElementById('loadMoreBtn').disabled = true;
    }
    
    hideLoading() {
        document.getElementById('loadingState').classList.add('d-none');
        document.getElementById('contractorsGrid').classList.remove('d-none');
        document.getElementById('loadMoreBtn').textContent = 'Load More Professionals';
        document.getElementById('loadMoreBtn').disabled = false;
    }
    
    updateResultsCount(total) {
        document.getElementById('resultsCount').textContent = total;
    }
    
    toggleView(view) {
        const grid = document.getElementById('contractorsGrid');
        if (view === 'list') {
            grid.classList.add('list-view');
        } else {
            grid.classList.remove('list-view');
        }
    }
    
    async submitQuickLead(form) {
        const formData = new FormData(form);
        const leadData = Object.fromEntries(formData);
        
        try {
            const response = await fetch('/api/leads', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(leadData)
            });
            
            if (response.ok) {
                // Show success message
                form.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 64px; margin-bottom: 20px;">‚úÖ</div>
                        <h3>Thank You!</h3>
                        <p>We've received your request and will connect you with qualified professionals in your area within 24 hours.</p>
                        <button class="btn btn-primary" onclick="location.reload()">Submit Another Request</button>
                    </div>
                `;
            }
        } catch (error) {
            console.error('Error submitting lead:', error);
        }
    }
    
    initLeadFormModal() {
        let currentStep = 1;
        const totalSteps = 3;
        
        const nextBtn = document.getElementById('nextStepBtn');
        const prevBtn = document.getElementById('prevStepBtn');
        const submitBtn = document.getElementById('submitLeadBtn');
        
        nextBtn.addEventListener('click', () => {
            if (currentStep < totalSteps) {
                currentStep++;
                this.updateModalStep(currentStep);
            }
        });
        
        prevBtn.addEventListener('click', () => {
            if (currentStep > 1) {
                currentStep--;
                this.updateModalStep(currentStep);
            }
        });
        
        submitBtn.addEventListener('click', () => {
            this.submitDetailedLead();
        });
    }
    
    updateModalStep(step) {
        // Update progress bar
        document.querySelectorAll('.progress-step').forEach((el, index) => {
            if (index + 1 < step) {
                el.classList.add('completed');
                el.classList.remove('active');
            } else if (index + 1 === step) {
                el.classList.add('active');
                el.classList.remove('completed');
            } else {
                el.classList.remove('active', 'completed');
            }
        });
        
        // Update form steps
        document.querySelectorAll('.form-step').forEach((el, index) => {
            if (index + 1 === step) {
                el.classList.add('active');
            } else {
                el.classList.remove('active');
            }
        });
        
        // Update buttons
        document.getElementById('prevStepBtn').style.display = step > 1 ? 'block' : 'none';
        document.getElementById('nextStepBtn').style.display = step < 3 ? 'block' : 'none';
        document.getElementById('submitLeadBtn').style.display = step === 3 ? 'block' : 'none';
    }
    
    async submitDetailedLead() {
        const form = document.getElementById('detailedLeadForm');
        const formData = new FormData(form);
        const leadData = Object.fromEntries(formData);
        
        try {
            const response = await fetch('/api/leads', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(leadData)
            });
            
            if (response.ok) {
                // Close modal and show success
                const modal = bootstrap.Modal.getInstance(document.getElementById('leadFormModal'));
                modal.hide();
                
                // Show success notification
                alert('Thank you! We\'ll connect you with qualified professionals soon.');
            }
        } catch (error) {
            console.error('Error submitting detailed lead:', error);
        }
    }
}

// Global functions
function openLeadForm() {
    const modal = new bootstrap.Modal(document.getElementById('leadFormModal'));
    modal.show();
}

function requestQuoteFromContractor(contractorId) {
    // Open lead form with contractor pre-selected
    openLeadForm();
}

function viewContractorProfile(contractorId) {
    // Navigate to contractor profile page
    window.location.href = `/contractors/${contractorId}`;
}

function resetContractorFilters() {
    document.getElementById('locationFilter').value = '';
    document.getElementById('specialtyFilter').value = '';
    document.getElementById('ratingFilter').value = '';
    document.getElementById('sortFilter').value = 'rating';
    
    const page = new ContractorsPage();
    page.filters = {};
    page.resetAndLoad();
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
    new ContractorsPage();
});
</script>
